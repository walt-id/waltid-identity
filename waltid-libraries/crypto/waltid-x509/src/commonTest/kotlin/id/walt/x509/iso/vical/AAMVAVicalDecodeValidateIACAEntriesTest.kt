package id.walt.x509.iso.vical

import id.walt.crypto.keys.jwk.JWKKey
import id.walt.x509.CertificateDer
import id.walt.x509.iso.iaca.parser.IACACertificateParser
import id.walt.x509.iso.iaca.validate.IACAValidator
import kotlinx.coroutines.test.runTest
import kotlinx.serialization.json.Json
import okio.ByteString.Companion.toByteString
import kotlin.test.Test

class AAMVAVicalDecodeValidateIACAEntriesTest {

    companion object {

        private val iacaParser = IACACertificateParser()
        private val validator = IACAValidator()

        /**
         * List of cherry-picked base64-encoded DER IACA certificates pulled from the AAMVA VICAL.
         * Original list of certificates was pulled from Mattr's "CAL Viewer" tool available (at the time of writing) on
         * the following URL: https://tools.mattrlabs.com/vical-viewer
         * The resulting list (below) was produced by filtering-out IACA certificates that:
         * - Expire in less than a year (give or take ;)) at the time of the list's compilation
         * */
        private val iacaPemEncodedCertificates = Json.decodeFromString<List<String>>(
            """
            [
                "MIICejCCAh+gAwIBAgIQP1fWX6bK5IWafQpOzL3JyjAKBggqhkjOPQQDAjBIMRYwFAYDVQQDDA1JQUNBLVVUQUgtVVNBMREwDwYDVQQKDAhVdGFoIERMRDEOMAwGA1UECAwFVVMtVVQxCzAJBgNVBAYTAlVTMB4XDTI1MDMxMTEyNDkyNVoXDTM0MDYwNzEyNDkyNFowSDEWMBQGA1UEAwwNSUFDQS1VVEFILVVTQTERMA8GA1UECgwIVXRhaCBETEQxDjAMBgNVBAgMBVVTLVVUMQswCQYDVQQGEwJVUzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABA9gsjBB4V6FtUGvCF/ZuQu65dfWIK87Yr1r4KzBM6LFvwxTB5MoWuS/JjyTZO3fENEFm3TtG+Js7KxIZMDClKyjgeowgecwEgYDVR0TAQH/BAgwBgEB/wIBADAfBgNVHSMEGDAWgBR9Bklm+FL6KtqQNeKXdsOkEUNg3TAnBgNVHRIEIDAehhxodHRwczovL21vYmlsZWRsLnVzL2lhY2EtdXQvMBEGA1UdIAQKMAgwBgYEVR0gADBFBgNVHR8EPjA8MDqgOKA2hjRodHRwOi8vd3d3Lm1vYmlsZWRsLnVzL3V0LWlhY2EvbWRsRFMtVVRBSC1VU0EwMDMuY3JsMB0GA1UdDgQWBBR9Bklm+FL6KtqQNeKXdsOkEUNg3TAOBgNVHQ8BAf8EBAMCAQYwCgYIKoZIzj0EAwIDSQAwRgIhAP2roq3hwjl7IQ9j52KMANKn9L9ornH31k42AAUjYALYAiEAhla2itEIdVuVipPO2JorLhEgkF1FzMIw0ggETTzLmGo=",
                "MIIDRzCCAu2gAwIBAgITVgO3G2afw4UBNWRnxbpYWrG5uTAKBggqhkjOPQQDAjCBnTEOMAwGA1UECBMFVVMtR0ExCzAJBgNVBAYTAlVTMRAwDgYDVQQHEwdDb255ZXJzMS4wLAYDVQQKEyVHZW9yZ2lhIERlcGFydG1lbnQgb2YgRHJpdmVyIFNlcnZpY2VzMQ8wDQYDVQQLEwZEUklWRVMxKzApBgNVBAMTIkdlb3JnaWEgUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcNMjQwMzIwMDQwMDAwWhcNMjkwMzIwMDQwMDAwWjCBnTEOMAwGA1UECBMFVVMtR0ExCzAJBgNVBAYTAlVTMRAwDgYDVQQHEwdDb255ZXJzMS4wLAYDVQQKEyVHZW9yZ2lhIERlcGFydG1lbnQgb2YgRHJpdmVyIFNlcnZpY2VzMQ8wDQYDVQQLEwZEUklWRVMxKzApBgNVBAMTIkdlb3JnaWEgUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASsRp10nCFKtW6sJL0xMPMKDCkeKFccLdRGKl2gN9tnzGi9aEee3z9S+vOH2EKTxFVmiqEmCS1u5LXCKkLIq+D+o4IBCDCCAQQwDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFK/NJTZCADkKrAM2Djwlii+UBPk1MEgGA1UdEgRBMD+BI2dyb3VwaXRwcm9kdWN0aW9uc3VwcG9ydEBkZHMuZ2EuZ292hhhodHRwczovL2Rkcy5nZW9yZ2lhLmdvdi8wYwYDVR0fBFwwWjBYoFagVIZSaHR0cHM6Ly93cy5kcml2ZXMuZ2EuZ292L1dlYlNlcnZpY2VzL05BL0dTUC9jZXJ0aWZpY2F0ZS9yZXZvY2F0aW9uL3Jldm9jYXRpb25zLmNybDAQBgkrBgEEAYPFIQEEA0dTUDAKBggqhkjOPQQDAgNIADBFAiBsNDY02UQq8xatSFHgcdQY64lL0EaaYKsDQ3AvZGjPgAIhAJtOn2wkum9vlccuEFL8XIgL6XHl2jEQSNKadqLoOk+T",
                "MIIDTzCCAvagAwIBAgIUALz9VunJbM8WsRyc10+waZ7TncgwCgYIKoZIzj0EAwIwgZwxDjAMBgNVBAgTBVVTLU1UMQswCQYDVQQGEwJVUzEPMA0GA1UEBxMGSGVsZW5hMSYwJAYDVQQKEx1Nb250YW5hIERlcGFydG1lbnQgb2YgSnVzdGljZTEnMCUGA1UECxMeTW9udGFuYSBNb3RvciBWZWhpY2xlIERpdmlzaW9uMRswGQYDVQQDExJjYXJzd3NucC5kb2ptdC5nb3YwHhcNMjUwNTAyMDYwMDAwWhcNMzAwNTAyMDYwMDAwWjCBnDEOMAwGA1UECBMFVVMtTVQxCzAJBgNVBAYTAlVTMQ8wDQYDVQQHEwZIZWxlbmExJjAkBgNVBAoTHU1vbnRhbmEgRGVwYXJ0bWVudCBvZiBKdXN0aWNlMScwJQYDVQQLEx5Nb250YW5hIE1vdG9yIFZlaGljbGUgRGl2aXNpb24xGzAZBgNVBAMTEmNhcnN3c25wLmRvam10LmdvdjBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABBdxLVV8czFFucq2cRy7ZLkvMScwfq4SgtTu2vhilCFy8BsjSt1QbefFoV+KpPqpCZJLQSWrhSopcS7GkDAgYe6jggESMIIBDjAOBgNVHQ8BAf8EBAMCAQYwEgYDVR0TAQH/BAgwBgEB/wIBADAdBgNVHQ4EFgQUI0+hpnnb+Y53pVjpRENxe7Xvdc8wOQYDVR0SBDIwMIEaY2Fyc2ludGVyZmFjZXRpY2tldEBtdC5nb3aGEmh0dHBzOi8vbXZkbXQuZ292LzB8BgNVHR8EdTBzMHGgb6BthmtodHRwczovL2NhcnMuZG9qbXQuZ292L2d3cHViL01vYmlsZUNyZWRlbnRpYWwvQ2VydGlmaWNhdGVzL1Jldm9jYXRpb25zLzMyNTk2ZGQyZDIwZjQ4M2M5NzRhMzhjYTEwN2Q1NDNlLmNybDAQBgkrBgEEAYPFIQEEA01KUDAKBggqhkjOPQQDAgNHADBEAiBzw8qDQXADtdQz8KZopvLZZ15G9CD64accLrUYYehkXAIgQiCPWmy2wdDP22dNUnbFRqblP+1K2TYlEV2A789ZOBI=",
                "MIIDQjCCAuegAwIBAgIUALj0FeW5Es6+r08rWsHsIA1igMAwCgYIKoZIzj0EAwIwgZ8xDjAMBgNVBAgTBVVTLU5EMQswCQYDVQQGEwJVUzERMA8GA1UEBxMIQmlzbWFyY2sxMjAwBgNVBAoTKU5vcnRoIERha290YSBEZXBhcnRtZW50IG9mIFRyYW5zcG9ydGF0aW9uMQ8wDQYDVQQLEwZMRUdFTkQxKDAmBgNVBAMTH2h0dHBzOi8vcGFydG5lci5tZGwuZG90Lm5kLmdvdi8wHhcNMjUwNjEwMDYwMDAwWhcNMzAwNjEwMDYwMDAwWjCBnzEOMAwGA1UECBMFVVMtTkQxCzAJBgNVBAYTAlVTMREwDwYDVQQHEwhCaXNtYXJjazEyMDAGA1UEChMpTm9ydGggRGFrb3RhIERlcGFydG1lbnQgb2YgVHJhbnNwb3J0YXRpb24xDzANBgNVBAsTBkxFR0VORDEoMCYGA1UEAxMfaHR0cHM6Ly9wYXJ0bmVyLm1kbC5kb3QubmQuZ292LzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABH7Etk/9zy7wqAwn8Qb1vzhMsx7H7JOYuTUbirPu26Q766Bndw8yyjZTRJp3pZeWWs4TbS668mcI1IUB+0e3gnqjgf4wgfswDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFGgohKo4OSffuHWBD5zP+1RjMCEGMDAGA1UdEgQpMCeBEGRvdG12dGVjaEBuZC5nb3aGE2h0dHBzOi8vZG90Lm5kLmdvdi8wcgYDVR0fBGswaTBnoGWgY4ZhaHR0cHM6Ly9kb3QubmQuZ292L0xFR0VOREVYVC9ETVAvRFNWUy9XZWJTZXJ2aWNlcy9tZGwvdjEvY3JsLzQ5ZDNmOTliMGQwNDQyMDY4ZDVlNzY0NWM0Njc5ZTk4LmNybDAQBgkrBgEEAYPFIQEEA0RNUDAKBggqhkjOPQQDAgNJADBGAiEA8ieW8neYho+hsu4hB2c9rekEh1+GopZ7r8Sz4JU1ctECIQDUGD/4QFHseFdQb/lLDjD6/xUfLfvrPD5my+wMSy8AIA==",
                "MIIDBzCCAqygAwIBAgIUE/iacpb/xR1hy0KQHlHoHjKGzRMwCgYIKoZIzj0EAwIwfzESMBAGA1UEAwwJTVZNUHJvZENBMS0wKwYDVQQKDCRBcml6b25hIERlcGFydG1lbnQgb2YgVHJhbnNwb3J0YXRpb24xCzAJBgNVBAsMAklUMQswCQYDVQQGEwJVUzEOMAwGA1UECAwFVVMtQVoxEDAOBgNVBAcMB1Bob2VuaXgwHhcNMjQwODE2MTc0NTIzWhcNMzQwODE2MTc0NTIzWjB/MRIwEAYDVQQDDAlNVk1Qcm9kQ0ExLTArBgNVBAoMJEFyaXpvbmEgRGVwYXJ0bWVudCBvZiBUcmFuc3BvcnRhdGlvbjELMAkGA1UECwwCSVQxCzAJBgNVBAYTAlVTMQ4wDAYDVQQIDAVVUy1BWjEQMA4GA1UEBwwHUGhvZW5peDBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABNUGhfC9l3WzXL+idfZ51dzwz4ieYigtGiJCGYT3CNHF9BYOWZxYPSCNgJvDKTC3B7q3Vs0pSJ6k1/EgzwooG4OjggEEMIIBADAdBgNVHQ4EFgQUrFA+KDiO+qv3pK27Wn8IQWsmzxUwHwYDVR0jBBgwFoAUrFA+KDiO+qv3pK27Wn8IQWsmzxUwEgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAQYwLAYDVR0SBCUwI4YhaHR0cHM6Ly9hemRvdC5nb3YvbXZkL2NvbnRhY3QtbXZkMGwGA1UdHwRlMGMwYaBfoF2GW2h0dHBzOi8vbXZtcHVibGljLmJsb2IuY29yZS51c2dvdmNsb3VkYXBpLm5ldC9jZXJ0aWZpY2F0ZS1yZXZvY2F0aW9uLWxpc3QvTVZNUHJvZENBLmNybC5wZW0wCgYIKoZIzj0EAwIDSQAwRgIhAMVvoqGUY5A4SLEkCpA+MTksCbKigfTEReO+44c88W+zAiEAwEMFKoWm4nD4h7bs3XoTmWxwbllG0nOh1tAVKRvyzM0=",
                "MIIC/jCCAqWgAwIBAgIUAMLBrrtl/kiPRa3nJEt18F/kojAwCgYIKoZIzj0EAwIwgY8xDjAMBgNVBAgTBVVTLUNPMQswCQYDVQQGEwJVUzEPMA0GA1UEBxMGRGVudmVyMScwJQYDVQQKEx5Db2xvcmFkbyBEZXBhcnRtZW50IG9mIFJldmVudWUxEjAQBgNVBAsTCUNPIERSSVZFUzEiMCAGA1UEAxMZQ29sb3JhZG8gUm9vdCBDZXJ0aWZpY2F0ZTAeFw0yNDEwMjkwNjAwMDBaFw0yOTEwMjkwNjAwMDBaMIGPMQ4wDAYDVQQIEwVVUy1DTzELMAkGA1UEBhMCVVMxDzANBgNVBAcTBkRlbnZlcjEnMCUGA1UEChMeQ29sb3JhZG8gRGVwYXJ0bWVudCBvZiBSZXZlbnVlMRIwEAYDVQQLEwlDTyBEUklWRVMxIjAgBgNVBAMTGUNvbG9yYWRvIFJvb3QgQ2VydGlmaWNhdGUwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAARuuLSkdRJ4QPEFqbPHmZP8Hbu8waHHJ6wKofZgHg7fOTUT4r+jV+jFpM5dNCbW/mdJyJwRCEsdOs3cvGtolt5No4HcMIHZMA4GA1UdDwEB/wQEAwIBBjASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBRuHjVnGUTr6tI5nEkfnK/3EFyP2DAkBgNVHRIEHTAbhhlodHRwczovL2Rtdi5jb2xvcmFkby5nb3YvMFwGA1UdHwRVMFMwUaBPoE2GS2h0dHBzOi8vZGV2Lm1vYmlsZWRsLmNvbS81MHB3cy9DUkwvbURMLzMxOTE0YzI5OWMxMTRhMWQ4ZjE4MTRlZTExOWU1NTdhLmNybDAQBgkrBgEEAYPFIQEEAzUwUDAKBggqhkjOPQQDAgNHADBEAiBr2FEgBjcMyt1WPtiV1tSYAAcP1OxcBofI6NNZbBEXcQIgRWFaTIFbsVXVyouuTnsNCB6JykHPP03sxjkyA/Wd5RE=",
                "MIICxjCCAmygAwIBAgITJkV7El8K11IXqY7mz96n/EhiITAKBggqhkjOPQQDAjBqMQ4wDAYDVQQIEwVVUy1NRDELMAkGA1UEBhMCVVMxFDASBgNVBAcTC0dsZW4gQnVybmllMRUwEwYDVQQKEwxNYXJ5bGFuZCBNVkExHjAcBgNVBAMTFUZhc3QgRW50ZXJwcmlzZXMgUm9vdDAeFw0yNDAxMDUwNTAwMDBaFw0yOTAxMDQwNTAwMDBaMGoxDjAMBgNVBAgTBVVTLU1EMQswCQYDVQQGEwJVUzEUMBIGA1UEBxMLR2xlbiBCdXJuaWUxFTATBgNVBAoTDE1hcnlsYW5kIE1WQTEeMBwGA1UEAxMVRmFzdCBFbnRlcnByaXNlcyBSb290MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEaWcKIqlAWboV93RAa5ad0LJBn8W0/yYwtOyUlxuTxoo4SPkorKmOz3EhThC+U4WRrt13aSnCsJtK+waBFghXu6OB8DCB7TAOBgNVHQ8BAf8EBAMCAQYwEgYDVR0TAQH/BAgwBgEB/wIBADAdBgNVHQ4EFgQUTprRzaFBJ1SLjJsO01tlLCQ4YF0wPAYDVR0SBDUwM4EWbXZhY3NAbWRvdC5zdGF0ZS5tZC51c4YZaHR0cHM6Ly9tdmEubWFyeWxhbmQuZ292LzBYBgNVHR8EUTBPME2gS6BJhkdodHRwczovL215bXZhLm1hcnlsYW5kLmdvdjo1NDQzL01EUC9XZWJTZXJ2aWNlcy9DUkwvbURML3Jldm9jYXRpb25zLmNybDAQBgkrBgEEAYPFIQEEA01EUDAKBggqhkjOPQQDAgNIADBFAiEAnX3+E4E5dQ+5G1rmStJTW79ZAiDTabyL8lJuYL/nDxMCIHHkAyIJcQlQmKDUVkBr3heUd5N9Y8GWdbWnbHuwe7Om",
                "MIIDcDCCAvagAwIBAgIUX9Ek9pKNP/yYUYu9pf6pyxFM2M4wCgYIKoZIzj0EAwMwSTEYMBYGA1UEAwwPQWxhc2thIERNViBJQUNBMRMwEQYDVQQKDApBbGFza2EgRE1WMQswCQYDVQQIDAJBSzELMAkGA1UEBhMCVVMwHhcNMjUwMjEyMjMyMjM4WhcNMzUwMjEwMjMyMjM3WjBJMRgwFgYDVQQDDA9BbGFza2EgRE1WIElBQ0ExEzARBgNVBAoMCkFsYXNrYSBETVYxCzAJBgNVBAgMAkFLMQswCQYDVQQGEwJVUzB2MBAGByqGSM49AgEGBSuBBAAiA2IABDMUuKt2Met/TjeB0klqsmfJyBiyc6liSk8s/R2FSwWJT10AzaWq3t77Fzl5xrUJfXrZOgmAad+R79nfCDKEw9nOUDyPxwnK+x1Tf56IyV9HEV9S5OweERm+HnOLqcYblqOCAZ0wggGZMBIGA1UdEwEB/wQIMAYBAf8CAQAwHwYDVR0jBBgwFoAUnG/8jgGkyjyKsmmZHwRklS8YxNQwMQYDVR0SBCowKIEmdXMuZGlzLm5vcmFtLml0LmFkbWluc0B0aGFsZXNncm91cC5jb20wMQYDVR0RBCowKIEmdXMuZGlzLm5vcmFtLml0LmFkbWluc0B0aGFsZXNncm91cC5jb20wgbAGA1UdHwSBqDCBpTCBoqCBn6CBnIaBmWh0dHA6Ly9pc3N1aW5nLmFrbWRsLnVzLmFwcC5hei5rZXlmYWN0b3JzYWFzLmNvbS9lamJjYS9wdWJsaWN3ZWIvd2ViZGlzdC9jZXJ0ZGlzdD9jbWQ9Y3JsJmlzc3Vlcj1DTiUzREFsYXNrYStETVYrSUFDQSUyQ08lM0RBbGFza2ErRE1WJTJDU1QlM0RBSyUyQ0MlM0RVUzAdBgNVHQ4EFgQUnG/8jgGkyjyKsmmZHwRklS8YxNQwGgYDVR0QBBMwEYEPMjAzMzAyMTAyMzIyMzhaMA4GA1UdDwEB/wQEAwIBBjAKBggqhkjOPQQDAwNoADBlAjBo/GoIeq0E6ZJAxUtMfyj3IYsXu9Aucg28yTfDAR0J8sqH18j3H9YThID1rFWT3+ECMQDlUAUD4AOg8BdCV9MJoBEMQXXPwa/NxLpRSrpshflgNiPYiTEagDl2oH5AglotZmU=",
                "MIIDBzCCAqygAwIBAgIUdBfQKZnHSlxQkyUoTuucN+EQXOMwCgYIKoZIzj0EAwIwfzESMBAGA1UEAwwJTVZNUHJvZENBMS0wKwYDVQQKDCRBcml6b25hIERlcGFydG1lbnQgb2YgVHJhbnNwb3J0YXRpb24xCzAJBgNVBAsMAklUMQswCQYDVQQGEwJVUzEOMAwGA1UECAwFVVMtQVoxEDAOBgNVBAcMB1Bob2VuaXgwHhcNMjQwODE2MTc0ODE3WhcNMzQwODE2MTc0ODE3WjB/MRIwEAYDVQQDDAlNVk1Qcm9kQ0ExLTArBgNVBAoMJEFyaXpvbmEgRGVwYXJ0bWVudCBvZiBUcmFuc3BvcnRhdGlvbjELMAkGA1UECwwCSVQxCzAJBgNVBAYTAlVTMQ4wDAYDVQQIDAVVUy1BWjEQMA4GA1UEBwwHUGhvZW5peDBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABCyuq/xwpmVAcoeIObjy1vvsWzMcivIIpfF6CxVyYoOQ7Dnu+dUEhqRKVrLMnzhoqDgKetzVHS4JQLCatOyus0CjggEEMIIBADAdBgNVHQ4EFgQUM0IsGLh/yqQ73mhM6h25/AsFp30wHwYDVR0jBBgwFoAUM0IsGLh/yqQ73mhM6h25/AsFp30wEgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAQYwLAYDVR0SBCUwI4YhaHR0cHM6Ly9hemRvdC5nb3YvbXZkL2NvbnRhY3QtbXZkMGwGA1UdHwRlMGMwYaBfoF2GW2h0dHBzOi8vbXZtcHVibGljLmJsb2IuY29yZS51c2dvdmNsb3VkYXBpLm5ldC9jZXJ0aWZpY2F0ZS1yZXZvY2F0aW9uLWxpc3QvTVZNUHJvZENBLmNybC5wZW0wCgYIKoZIzj0EAwIDSQAwRgIhANuxS8uit1Hqj75A8J8RYSVFVLFIBHkqDvePviN8ZrwWAiEAwnolRQsC2bnEbVD2fCacCsnb58Hz+5RDm49N0aEhIv8=",
                "MIIC7jCCApWgAwIBAgIUAIlZVGm+MFztWeqnzmHC1Liq1DAwCgYIKoZIzj0EAwIwZjEOMAwGA1UECBMFVVMtTUQxCzAJBgNVBAYTAlVTMRQwEgYDVQQHEwtHbGVuIEJ1cm5pZTEVMBMGA1UEChMMTWFyeWxhbmQgTVZBMRowGAYDVQQDExFNRE9UIE1WQSBtREwgUm9vdDAeFw0yNTA2MTgwNjAwMDBaFw0zMDA2MTgwNjAwMDBaMGYxDjAMBgNVBAgTBVVTLU1EMQswCQYDVQQGEwJVUzEUMBIGA1UEBxMLR2xlbiBCdXJuaWUxFTATBgNVBAoTDE1hcnlsYW5kIE1WQTEaMBgGA1UEAxMRTURPVCBNVkEgbURMIFJvb3QwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAATSFdDeo2zV3GjlWdICLEyVygkyiM3579U/WAtsibXSWXpXeAkENed6fs8a4lPCm3ScBa/GHQsc/xPWG5brrf/vo4IBHzCCARswDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFLSwEXEzIOHS6lueN/d0ga94nZ3dMFUGA1UdEgROMEyBHG12YXByaXZhY3lAbWRvdC5tYXJ5bGFuZC5nb3aGLGh0dHBzOi8vbXltdmEubWFyeWxhbmQuZ292L2dvL3dlYi9Db250YWN0TVZBMG0GA1UdHwRmMGQwYqBgoF6GXGh0dHBzOi8vbXltdmEubWFyeWxhbmQuZ292OjU0NDMvTURQL1dlYlNlcnZpY2VzL0NSTC9tREwvNmVlMDdkMjE0MGYwNDJhMGE2ZTk5YTc4ZTQwNzlhYzAuY3JsMBAGCSsGAQQBg8UhAQQDTURQMAoGCCqGSM49BAMCA0cAMEQCIEOzO/2dCcx5yn8Hx6AdqCqgTNps18RrB0QGoHrwkFnxAiBApe5NXVdvg2yEhQylijYaUKTpJKNTiOx0CRPusfR5SQ==",
                "MIICWDCCAf+gAwIBAgIUSDXJYXPM1GzzndPu7U7uQQpoOU4wCgYIKoZIzj0EAwIwNTEWMBQGA1UEAwwNVkEgbUlEIElBQ0EtQTEOMAwGA1UECAwFVVMtVkExCzAJBgNVBAYTAlVTMB4XDTI1MDcyMjEzMjYwMloXDTI3MDcyMjEzMjYwMVowNTEWMBQGA1UEAwwNVkEgbUlEIElBQ0EtQTEOMAwGA1UECAwFVVMtVkExCzAJBgNVBAYTAlVTMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEZ96O6yAnVSQogBLxplgoWuEQbJGeNwkiC1Hx2MEKM6Jnpq4Wls+GU9IWImlUWWTaY0fgf+51Wkq1dguB8cVme6OB7DCB6TASBgNVHRMBAf8ECDAGAQH/AgEAMB8GA1UdIwQYMBaAFJYUvOtd2fu7Ag6feF/TB+YJ9+FNMCMGA1UdEgQcMBqGGGh0dHBzOi8vZG12LnZpcmdpbmlhLmdvdjAjBgNVHREEHDAahhhodHRwczovL2Rtdi52aXJnaW5pYS5nb3YwOQYDVR0fBDIwMDAuoCygKoYoaHR0cHM6Ly93d3cubW9iaWxlZGwubmV0L21vYmlsZUlEL1ZBLmNybDAdBgNVHQ4EFgQUlhS8613Z+7sCDp94X9MH5gn34U0wDgYDVR0PAQH/BAQDAgEGMAoGCCqGSM49BAMCA0cAMEQCIAZyBOjZrupvH9PqbgZNZFtgwVs+fXZVqgJKckP6FAbrAiAQdjxr6xA4VRVp/yjS9CKGoMw7tPkUrcfofZTv2AvPCA==",
                "MIICeDCCAh+gAwIBAgIQWluwShGaNXltKtR32ToazDAKBggqhkjOPQQDAjBIMRYwFAYDVQQDDA1JQUNBLVVUQUgtVVNBMREwDwYDVQQKDAhVdGFoIERMRDEOMAwGA1UECAwFVVMtVVQxCzAJBgNVBAYTAlVTMB4XDTIzMTIxODEyMjU0N1oXDTMyMTIxNTEyMjU0NlowSDEWMBQGA1UEAwwNSUFDQS1VVEFILVVTQTERMA8GA1UECgwIVXRhaCBETEQxDjAMBgNVBAgMBVVTLVVUMQswCQYDVQQGEwJVUzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABGHwBQyjlOERffLUFurAF9F0gyRuD34FkPK8RfVuySJrooUnBi86jfKAEIFGzhAiR48EUe6YK2YcqfUqrEOX3uajgeowgecwEgYDVR0TAQH/BAgwBgEB/wIBADAfBgNVHSMEGDAWgBQ8TGzf54I0LuEU5s6tEgo5/Qg0azAnBgNVHRIEIDAehhxodHRwczovL21vYmlsZWRsLnVzL2lhY2EtdXQvMBEGA1UdIAQKMAgwBgYEVR0gADBFBgNVHR8EPjA8MDqgOKA2hjRodHRwOi8vd3d3Lm1vYmlsZWRsLnVzL3V0LWlhY2EvbWRsRFMtVVRBSC1VU0EwMDIuY3JsMB0GA1UdDgQWBBQ8TGzf54I0LuEU5s6tEgo5/Qg0azAOBgNVHQ8BAf8EBAMCAQYwCgYIKoZIzj0EAwIDRwAwRAIgdzrANru5rEm8T4qsYoPEo5YqJ6wyZstAfMfkp9/BtjcCIEez933eeyubFUfqjd3hXIoRcl1E0UTdnk/UOBLQCG10",
                "MIIDBzCCAqygAwIBAgIUO/uWVmabBSV9o4SeYj6ioDz+HSYwCgYIKoZIzj0EAwIwfzESMBAGA1UEAwwJTVZNUHJvZENBMS0wKwYDVQQKDCRBcml6b25hIERlcGFydG1lbnQgb2YgVHJhbnNwb3J0YXRpb24xCzAJBgNVBAsMAklUMQswCQYDVQQGEwJVUzEOMAwGA1UECAwFVVMtQVoxEDAOBgNVBAcMB1Bob2VuaXgwHhcNMjQwODE2MTc0MDE5WhcNMzQwODE2MTc0MDE5WjB/MRIwEAYDVQQDDAlNVk1Qcm9kQ0ExLTArBgNVBAoMJEFyaXpvbmEgRGVwYXJ0bWVudCBvZiBUcmFuc3BvcnRhdGlvbjELMAkGA1UECwwCSVQxCzAJBgNVBAYTAlVTMQ4wDAYDVQQIDAVVUy1BWjEQMA4GA1UEBwwHUGhvZW5peDBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABFJpz6RkzZWqyVQ8CemsHjvLKY5JnInhby/1RHU6EErW04tvKjUSOpidfc1xcYG1pzJeCDGQPsju/LJue0vEKQKjggEEMIIBADAdBgNVHQ4EFgQUJkHD1SkBjqmWg4Z2gwJ8RxDI/vEwHwYDVR0jBBgwFoAUJkHD1SkBjqmWg4Z2gwJ8RxDI/vEwEgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAQYwLAYDVR0SBCUwI4YhaHR0cHM6Ly9hemRvdC5nb3YvbXZkL2NvbnRhY3QtbXZkMGwGA1UdHwRlMGMwYaBfoF2GW2h0dHBzOi8vbXZtcHVibGljLmJsb2IuY29yZS51c2dvdmNsb3VkYXBpLm5ldC9jZXJ0aWZpY2F0ZS1yZXZvY2F0aW9uLWxpc3QvTVZNUHJvZENBLmNybC5wZW0wCgYIKoZIzj0EAwIDSQAwRgIhAI1/E8XQ/v4SQ92sPRivZLWK9hUYz3ZCdMBvMqQX322JAiEA8Nta7T9167ux1weIgBy+66L7G5jimCxjO1ECnai4Kl8="
            ]
        """.trimIndent()
        )
    }

    @Test
    fun `must be able to decode and validate all qualified AAMVA IACA certificate entries`() = runTest {
        iacaPemEncodedCertificates.map { pemEncodedCertificate ->
            JWKKey.convertDERorPEMtoByteArray(pemEncodedCertificate)
        }.forEach { derEncodedCertificate ->
            val iacaDecodedCertificate = iacaParser.parse(
                certificate = CertificateDer(
                    bytes = derEncodedCertificate.toByteString(),
                ),
            )

            validator.validate(iacaDecodedCertificate)
        }
    }
}
