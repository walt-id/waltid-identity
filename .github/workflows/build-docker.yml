name: Build on every push except main branch

on:
  push:
    branches-ignore:
      - main


jobs:
  build:
    name: "Build"
    runs-on: "ubuntu-latest"
    steps:
      - uses: actions/checkout@v4
      - name: Setup cache
        uses: actions/cache@v2
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-
      - name: Build and push Docker images (issuer)
        uses: docker/build-push-action@v4.0.0
        with:
          push: false
          file: waltid-issuer-api/Dockerfile
          #tags: waltid/issuer-api:latest, waltid/issuer-api:${{ env.release_version }}
      - name: Build and push Docker images (verifier)
        uses: docker/build-push-action@v4.0.0
        with:
          push: false
          file: waltid-verifier-api/Dockerfile
          #tags: waltid/verifier-api:latest, waltid/verifier-api:${{ env.release_version }}
      - name: Build and push Docker images (wallet-api)
        uses: docker/build-push-action@v4.0.0
        with:
          push: false
          file: waltid-wallet-api/Dockerfile
          #tags: waltid/wallet-api:latest, waltid/wallet-api:${{ env.release_version }}
      - name: Build and push Docker images (waltid-web-wallet)
        uses: docker/build-push-action@v4.0.0
        with:
          push: false
          file: waltid-web-wallet/Dockerfile
          #tags: waltid/waltid-web-wallet:latest, waltid/waltid-web-wallet:${{ env.release_version }}
      - name: Build and push Docker images (wallet-portal)
        uses: docker/build-push-action@v4
        with:
          push: false
          file: waltid-web-portal/Dockerfile
          #tags: waltid/portal:latest, waltid/portal:${{ env.release_version }}

